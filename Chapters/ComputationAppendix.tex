\chapter{Detecting Screen Reader Latency}\label{chap:computationappendix}

Evaluations were completed on laptops purchased in 2024-2025. One with 8GB RAM, one with 16GB RAM, one with 24GB, one with 32GB, and one with 64GB RAM. 

\section{JAWS Latency Quantification}
To detect screen reader latency I used the following suite of tools written in python.

\begin{pyverbatim}
import os
import psutil
import subprocess
import time
import json
import sounddevice as sd
import numpy as np
from pynput.keyboard import Controller
from pywinauto import Application
import win32gui
import win32process

# === CONFIGURATION ===
SCREEN_READERS = {
    "JAWS": {
        "process": "jfw.exe",
        "path": r"C:\Program Files\Freedom Scientific\JAWS\2025\jfw.exe",
        "config_path": os.path.expandvars(r"%APPDATA%\Freedom Scientific\JAWS\2025\Settings\enu\default.jcf")
    },
    "NVDA": {
        "process": "nvda.exe",
        "path": r"C:\Program Files\NVDA\nvda.exe",
        "config_path": os.path.expandvars(r"%APPDATA%\nvda\nvda.ini")
    },
    "SuperNova": {
        "process": "supernova.exe",
        "path": r"C:\Program Files\Dolphin\SuperNova\supernova.exe"
    }
}

KEY_TO_PRESS = 'a'
DURATION_SECONDS = 5
SAMPLE_RATE = 44100
THRESHOLD = 0.05
LOGFILE = "suite_latency_log.json"

keyboard = Controller()

def is_process_running(name):
    for proc in psutil.process_iter(['pid', 'name']):
        if proc.info['name'] and proc.info['name'].lower() == name.lower():
            return proc.info['pid']
    return None

def launch_screen_reader(reader):
    info = SCREEN_READERS.get(reader)
    path = info["path"]
    if os.path.isfile(path):
        subprocess.Popen([path])
        time.sleep(5)
        return is_process_running(info["process"])
    return None

def activate_reader_window(reader):
    info = SCREEN_READERS.get(reader)
    proc_name = info["process"]
    for proc in psutil.process_iter(['pid', 'name']):
        if proc.info['name'].lower() == proc_name:
            try:
                app = Application(backend="uia").connect(process=proc.info['pid'])
                app.top_window().set_focus()
                return True
            except Exception:
                return False
    return False

def get_foreground_app_name():
    hwnd = win32gui.GetForegroundWindow()
    _, pid = win32process.GetWindowThreadProcessId(hwnd)
    try:
        return psutil.Process(pid).name()
    except psutil.NoSuchProcess:
        return None

def is_nvda_muted():
    cfg = SCREEN_READERS["NVDA"]["config_path"]
    if not os.path.exists(cfg):
        return None
    with open(cfg, "r", encoding="utf-8") as f:
        for line in f:
            if line.strip().lower().startswith("speechmode"):
                val = line.strip().split("=")[-1].strip().lower()
                return val in ["off", "beeps"]
    return None

def get_jaws_verbosity_mode():
    cfg = SCREEN_READERS["JAWS"]["config_path"]
    if not os.path.exists(cfg):
        return None
    try:
        with open(cfg, "r", encoding="utf-8", errors="ignore") as f:
            for line in f:
                if "VerbosityLevel" in line:
                    val = ''.join([c for c in line if c.isdigit()])
                    return int(val) if val else None
    except Exception:
        return None
    return None

def detect_or_start_readers(focus=True, auto_start=True):
    report = {}
    for reader, info in SCREEN_READERS.items():
        pid = is_process_running(info["process"])
        if not pid and auto_start:
            pid = launch_screen_reader(reader)
        status = {"running": bool(pid), "pid": pid, "focused": False}

        if pid and focus:
            focused = activate_reader_window(reader)
            status["focused"] = focused

        if reader == "NVDA" and pid:
            status["muted"] = is_nvda_muted()
        if reader == "JAWS" and pid:
            status["verbosity_level"] = get_jaws_verbosity_mode()

        report[reader] = status
    return report

def detect_audio_peak(audio_data, fs, threshold=0.05):
    frame_rms = np.sqrt(np.mean(np.square(audio_data), axis=1))
    for i, amp in enumerate(frame_rms):
        if amp > threshold:
            return i / fs
    return None

def measure_latency():
    audio_data = []
    def callback(indata, frames, time_info, status):
        audio_data.append(indata.copy())

    with sd.InputStream(callback=callback, channels=1, samplerate=SAMPLE_RATE):
        time.sleep(1)
        keypress_time = time.time()
        keyboard.press(KEY_TO_PRESS)
        keyboard.release(KEY_TO_PRESS)
        time.sleep(DURATION_SECONDS)

    audio = np.concatenate(audio_data, axis=0).flatten()
    latency_offset = detect_audio_peak(audio.reshape(-1, 1), SAMPLE_RATE, THRESHOLD)
    if latency_offset is not None:
        return {
            "keypress_time": keypress_time,
            "audio_feedback_time": keypress_time + latency_offset,
            "latency_ms": round(latency_offset * 1000, 2),
            "success": True
        }
    return {
        "keypress_time": keypress_time,
        "audio_feedback_time": None,
        "latency_ms": None,
        "success": False
    }

def run_suite():
    full_log = {
        "timestamp": time.strftime("%Y-%m-%dT%H:%M:%S"),
        "foreground_app_before_keypress": get_foreground_app_name(),
        "screen_reader_status": detect_or_start_readers(focus=True, auto_start=True),
        "keypress_to_audio_latency": measure_latency()
    }
    with open(LOGFILE, "w") as f:
        json.dump(full_log, f, indent=2)
    return full_log

run_suite()
\end{pyverbatim}

\section{JAWS Latency Quantification \& Printing}
Data collected and the below analysis indicates that screen reader latency is significantly affected by hardware specifications, particularly RAM and CPU performance. Further testing and data collection are necessary to establish comprehensive guidelines for optimal configurations.
\begin{pyverbatim}
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import seaborn as sns
from io import StringIO
import re
import os
from itertools import combinations
from scipy.stats import ttest_ind

# === CONFIG ===
SAVE_DIR = os.path.expanduser("~/Downloads")
os.makedirs(SAVE_DIR, exist_ok=True)
STATS_FILE = os.path.join(SAVE_DIR, "stats.md")

# === FULL DATASETS WITH JAWS / NVDA / SUPERNOVA COLUMNS ===
datasets = {
    'Keystroke Response': """JAWS8GB	JAWS16GB	JAWS24GB	JAWS32GB	JAWS64GB	NVDA8GB	NVDA16GB	NVDA24GB	NVDA32GB	NVDA64GB	SUPERNOVA8GB	SUPERNOVA16GB	SUPERNOVA24GB	SUPERNOVA32GB	SUPERNOVA64GB
154	361	97	56	24	110	145	113	90	20	84	357	57	45	16
528	325	79	44	19	174	196	135	86	25	433	297	55	30	11
933	130	119	54	31	218	192	111	62	15	858	48	92	44	20
325	336	176	62	28	370	198	177	36	33	264	278	149	52	17
197	428	246	87	16	238	138	108	98	33	115	420	216	77	6
534	347	240	49	38	139	165	95	63	13	482	294	210	33	29
399	165	231	68	46	214	185	182	90	18	377	100	202	57	36
579	376	85	48	21	158	148	102	89	17	481	308	60	37	10
855	228	118	36	19	158	163	147	40	25	781	179	84	23	8
910	352	95	66	35	174	182	142	64	23	825	329	56	56	24
525	418	106	80	23	126	150	170	76	22	503	376	76	64	14
227	343	247	62	26	197	175	121	99	15	139	256	223	50	18
797	360	110	71	48	388	130	165	69	19	744	273	70	59	38
715	247	94	83	41	389	158	173	40	31	619	224	62	73	32
863	319	165	61	16	292	112	114	65	12	802	222	126	51	7
977	457	229	41	15	195	121	86	34	16	895	383	193	23	4
614	455	122	41	21	301	152	127	62	33	533	452	88	31	10
843	400	184	92	33	231	158	114	69	18	777	358	159	76	24
579	421	244	62	29	112	180	169	73	16	549	363	207	51	18
886	370	239	68	33	343	175	123	93	15	789	352	201	57	25
957	337	243	100	41	236	121	136	52	18	914	255	219	89	33
210	273	214	60	16	125	199	111	49	18	177	233	189	43	5
260	295	83	54	41	270	200	151	52	33	219	279	56	40	31
857	327	183	57	26	179	115	175	88	26	796	272	153	39	18
754	130	118	83	19	259	120	100	90	20	657	105	89	73	9
350	337	173	65	21	372	184	137	41	33	286	323	150	53	10
279	145	236	34	40	115	173	147	39	30	204	122	213	18	32
508	214	187	79	20	159	188	142	87	27	482	132	155	65	9
445	264	79	55	19	177	159	114	89	23	359	233	52	39	8
459	154	137	65	43	188	156	133	47	32	422	131	103	49	35
424	169	237	94	41	290	175	102	72	13	324	144	207	80	31
778	303	249	46	30	254	175	107	59	29	735	258	218	33	22
748	367	220	55	16	121	185	183	62	19	692	298	187	44	6
934	306	194	100	38	128	116	143	65	16	885	279	167	82	30
774	472	224	78	34	300	190	155	94	28	674	451	198	67	24
620	334	169	53	25	268	199	95	85	24	575	275	136	42	17
665	462	93	32	37	120	112	157	93	29	576	429	61	18	29
446	360	204	99	42	299	148	186	87	18	382	313	168	85	31
986	151	129	48	19	123	192	130	83	15	893	89	105	31	11
490	357	127	73	21	379	173	120	86	24	416	349	101	59	11
661	194	84	68	36	213	112	150	31	31	620	145	49	57	26
513	477	100	58	50	221	157	129	58	28	475	436	76	40	39
190	382	245	100	21	398	154	137	35	28	163	343	206	89	13
316	458	128	83	41	124	191	105	48	15	255	397	98	71	31
786	420	236	58	50	397	166	127	48	20	691	320	208	47	40
654	362	120	99	23	248	113	86	55	23	575	321	95	88	13
300	446	239	63	22	347	186	112	54	30	205	438	207	53	12
924	370	199	67	23	238	186	178	55	35	860	279	176	53	12
819	149	170	89	17	184	153	145	37	33	771	81	134	72	9
311	321	215	89	29	216	180	87	86	10	226	302	178	79	21
256	232	188	82	40	114	137	164	70	11	217	220	149	67	29
904	204	137	34	47	122	169	103	57	16	867	179	113	21	38
313	375	113	97	19	274	185	95	36	13	280	317	85	82	9
812	131	77	84	36	171	124	163	85	35	748	121	41	69	25
929	303	213	54	46	287	117	164	92	22	906	256	173	39	35
412	248	220	40	37	252	162	138	40	29	368	151	180	27	29
256	481	188	40	35	189	159	114	30	29	182	469	150	27	27
389	185	225	41	18	209	122	130	35	20	368	148	197	27	9
623	447	129	42	50	399	147	126	99	30	541	376	102	27	41
694	153	119	56	16	382	145	94	53	11	618	132	92	44	7
236	455	140	83	43	246	139	90	87	26	201	430	107	72	35
862	375	247	43	49	242	118	149	59	19	796	282	219	26	41
847	298	224	63	17	382	163	102	50	22	781	276	184	50	8
285	239	78	91	40	162	188	158	94	30	208	165	47	81	31
828	277	161	99	50	214	194	168	71	21	801	267	128	89	40
713	383	246	85	33	202	114	136	82	35	656	365	220	67	23
226	291	245	76	25	111	182	169	63	31	186	252	215	59	14
626	227	117	63	24	255	184	97	41	21	549	155	89	45	16
955	227	132	63	16	337	144	89	79	20	855	185	101	47	5
161	174	189	50	32	218	131	167	56	15	128	166	162	37	23
802	141	134	58	26	298	132	153	41	27	738	121	108	44	18
615	131	204	55	22	282	113	152	52	11	580	33	180	40	13
507	461	144	31	26	235	184	187	88	20	428	395	111	16	15
230	130	151	90	43	393	116	150	57	30	199	86	119	73	32
594	425	145	68	22	209	161	149	50	24	527	357	117	53	13
548	321	176	47	30	298	136	129	77	33	469	316	147	37	19
992	416	129	86	44	359	124	134	84	31	945	396	91	74	33
284	198	196	42	16	230	159	180	40	18	196	167	157	31	8
534	322	131	48	42	313	147	139	68	30	482	307	101	38	31
195	219	247	53	40	252	123	122	90	11	153	140	222	36	32
731	200	247	34	36	281	183	141	79	31	643	157	219	22	27
837	373	185	38	22	345	154	110	41	18	739	322	155	24	12
754	480	148	76	38	337	169	179	33	16	688	424	109	62	28
208	369	121	78	26	130	149	146	63	20	186	335	97	60	17
955	323	155	98	32	123	115	155	92	13	896	234	127	88	24
485	460	76	87	21	243	146	91	98	14	409	432	41	72	11
294	205	244	94	31	320	197	154	43	26	220	161	221	83	20
600	136	211	46	32	118	116	91	87	29	520	45	177	33	23
654	194	127	64	16	255	113	106	44	12	579	127	91	49	8
866	459	205	74	34	142	193	176	57	19	811	412	174	61	23
591	369	125	92	20	344	110	124	52	14	530	304	88	79	12
201	295	131	44	32	270	164	177	53	23	140	207	107	30	22
804	165	108	81	37	373	192	164	94	23	745	94	76	68	28
670	140	78	57	30	398	137	95	70	23	636	117	55	44	21
580	494	203	57	39	328	130	167	88	17	517	483	164	41	31
902	254	80	34	25	322	181	147	50	12	832	157	50	17	15
799	368	165	80	27	193	163	126	75	25	741	318	129	62	16
918	424	171	77	27	185	138	100	56	20	895	341	139	59	19
813	241	160	72	20	299	119	108	89	18	716	210	122	57	12
""",

    'Navigation Commands': """JAWS8GB	JAWS16GB	JAWS24GB	JAWS32GB	JAWS64GB	NVDA8GB	NVDA16GB	NVDA24GB	NVDA32GB	NVDA64GB	SUPERNOVA8GB	SUPERNOVA16GB	SUPERNOVA24GB	SUPERNOVA32GB	SUPERNOVA64GB
418	225	241	41	41	274	196	95	82	32	336	187	208	25	30
361	388	219	68	50	313	172	184	92	26	320	316	184	51	39
218	305	109	20	24	336	169	121	30	35	120	245	72	8	14
879	399	235	70	17	241	154	157	51	31	833	306	205	56	8
530	254	197	64	41	165	162	143	46	23	489	211	161	53	33
624	144	166	55	29	184	176	150	37	35	574	118	140	42	21
900	432	239	39	15	173	135	106	86	27	870	389	215	24	4
819	206	101	45	10	215	129	157	80	25	746	161	65	34	1
474	190	119	26	39	129	164	133	81	18	398	129	82	9	30
303	497	135	75	21	124	155	175	97	16	220	422	103	64	11
560	182	168	56	35	188	196	139	37	15	519	167	145	40	25
421	310	241	28	13	271	113	108	55	18	396	283	217	15	4
830	321	142	69	46	372	159	158	48	14	785	271	113	57	36
216	364	227	67	23	381	114	177	64	10	167	309	192	51	13
322	301	241	24	42	346	156	88	82	11	285	223	202	7	34
981	157	171	66	24	280	111	167	43	10	946	57	138	49	16
851	279	91	69	17	273	148	164	49	28	762	277	62	56	8
372	286	221	38	17	181	153	186	37	24	306	196	181	26	8
634	438	102	65	39	347	184	159	90	26	581	364	67	53	28
970	462	229	57	22	288	158	141	52	14	934	394	189	39	12
539	234	191	68	43	110	113	144	36	31	491	184	155	54	35
726	351	201	28	35	178	164	120	52	33	691	343	176	14	27
771	386	224	41	44	143	116	100	57	12	730	312	199	24	33
650	246	199	20	46	272	171	187	86	24	600	242	164	4	38
679	144	114	52	38	338	178	103	39	17	611	87	86	39	29
241	480	181	62	33	239	157	172	77	15	195	409	149	46	23
532	401	216	20	16	164	168	146	70	32	444	378	182	8	5
857	406	139	57	48	141	183	146	93	13	778	390	111	41	40
912	187	130	33	49	133	169	104	96	10	849	182	97	18	39
692	374	233	20	24	179	145	175	67	21	667	316	208	9	16
606	321	210	31	24	328	156	86	45	33	567	231	184	20	15
204	150	245	26	24	336	155	150	73	22	135	94	218	15	15
337	212	115	73	41	170	155	132	72	33	249	123	75	58	30
912	410	119	52	23	310	159	92	30	35	838	365	83	40	14
897	313	152	46	34	142	177	115	84	10	822	252	112	35	23
555	125	108	38	20	243	192	153	70	10	512	97	69	25	12
811	368	151	51	41	304	153	118	82	35	779	353	112	36	33
500	360	186	52	10	127	184	153	43	30	404	276	153	38	0
843	188	98	60	25	312	156	141	94	23	747	108	62	44	14
248	158	145	37	50	280	181	142	40	23	149	80	108	26	41
527	307	143	24	14	396	117	156	52	19	475	207	107	13	3
231	200	105	40	47	373	121	163	61	13	177	182	80	27	37
520	376	138	31	22	166	184	110	34	29	482	283	113	19	14
695	275	172	72	18	252	145	166	90	30	598	254	140	55	9
477	153	244	24	32	267	127	185	99	11	451	58	212	8	22
963	344	173	61	32	295	156	170	82	29	929	288	141	47	21
380	211	107	30	41	288	130	183	34	10	300	136	69	19	31
958	148	234	21	50	385	124	140	87	27	926	128	208	4	40
996	402	238	53	30	237	192	181	58	12	927	349	209	39	21
304	379	214	68	16	110	141	158	33	31	279	327	191	57	7
753	499	108	66	25	299	185	107	70	16	699	446	71	56	16
750	350	241	75	45	391	124	109	89	30	679	254	207	63	34
553	205	242	35	11	181	177	139	30	17	512	105	218	18	2
663	144	233	70	16	189	114	137	80	30	596	103	205	59	6
934	350	185	62	22	143	111	134	79	24	836	346	161	45	12
232	491	232	29	20	298	145	186	33	24	140	483	194	18	10
296	413	138	71	40	378	148	130	76	14	239	398	102	58	32
497	360	188	20	10	215	129	121	45	27	412	341	150	6	5
679	327	229	64	40	336	184	139	70	16	605	236	189	51	29
341	247	162	35	26	213	197	98	77	30	246	191	133	18	16
371	267	194	63	17	198	163	94	59	21	322	191	156	52	9
883	384	176	65	25	260	181	155	45	32	803	368	139	51	15
375	351	96	29	46	163	152	103	69	12	283	306	71	15	36
602	474	104	31	14	203	168	108	83	30	562	388	71	13	5
861	127	185	44	39	180	165	113	78	18	836	35	162	27	29
787	297	161	41	47	222	118	125	32	33	692	271	130	30	39
461	169	238	44	28	208	165	143	86	23	396	162	215	26	18
512	500	154	49	18	246	123	155	41	28	483	487	121	31	7
253	200	104	56	16	374	172	131	46	35	210	110	74	46	7
567	405	214	67	12	116	174	151	36	15	536	363	182	55	1
854	189	206	72	22	399	143	133	92	12	766	133	168	59	14
966	149	130	38	27	255	200	137	80	32	935	58	94	20	18
417	174	162	52	48	200	146	150	49	17	331	162	128	42	37
618	345	93	32	12	146	177	141	60	28	568	257	67	16	1
268	451	108	44	28	333	168	103	95	18	237	441	75	26	20
638	286	177	53	30	306	192	129	62	24	583	233	138	43	20
624	319	218	24	38	301	198	97	65	18	535	258	179	9	29
370	402	135	25	24	287	121	126	30	26	275	345	100	9	15
267	440	137	30	40	355	139	149	50	25	194	405	112	20	32
315	368	189	55	17	343	140	96	59	34	283	297	157	39	6
917	386	242	28	44	288	135	139	89	21	876	298	207	12	36
951	208	223	74	10	112	194	177	39	20	916	145	196	58	0.5
884	371	102	32	41	396	119	166	66	35	843	302	69	14	33
559	147	122	42	13	212	199	164	37	17	459	71	97	32	4
792	431	138	21	24	278	178	164	32	33	771	351	109	8	15
680	164	153	52	33	288	147	161	60	17	626	152	122	41	23
788	302	231	42	18	306	180	116	43	11	749	286	195	29	8
382	285	214	33	15	147	201	138	70	31	304	209	191	23	5
614	262	106	75	27	331	118	135	30	24	576	245	75	57	17
231	218	111	36	19	399	155	121	59	18	157	213	88	19	11
280	139	98	66	31	398	171	164	49	10	256	51	68	56	20
790	177	242	40	48	130	128	88	63	27	745	80	215	28	38
928	205	115	55	40	198	169	163	30	21	847	156	86	38	30
813	495	203	30	29	320	164	176	58	33	735	463	173	12	21
979	488	192	36	19	228	177	141	70	27	899	423	157	21	11
411	381	189	46	46	227	125	178	64	29	357	377	164	33	38
675	379	99	20	16	396	159	148	91	28	628	289	59	4	6
773	376	160	23	31	265	198	126	45	28	739	285	126	6	22
966	303	164	20	23	124	158	157	49	10	873	209	138	8	12
""",

    'Load Time': """JAWS8GB	JAWS16GB	JAWS24GB	JAWS32GB	JAWS64GB	NVDA8GB	NVDA16GB	NVDA24GB	NVDA32GB	NVDA64GB	SUPERNOVA8GB	SUPERNOVA16GB	SUPERNOVA24GB	SUPERNOVA32GB	SUPERNOVA64GB
101	65	57	18	3	17	16	9	9	3	83	56	54	15	4
116	83	51	16	10	14	16	6	10	3	94	81	55	13	11
162	68	52	17	8	21	9	7	12	2	135	65	61	18	8
120	42	54	15	9	17	11	8	2	1	134	17	36	9	8
110	59	41	12	1	18	12	14	10	2	122	29	53	18	1
158	38	49	19	3	21	11	7	6	4	160	12	29	14	2
139	64	42	9	9	10	8	9	8	1	110	48	35	3	10
146	40	37	19	9	12	13	11	12	2	130	29	47	20	9
145	50	31	20	4	14	8	9	3	3	137	37	31	20	4
114	87	64	8	7	16	14	10	3	3	108	81	36	2	7
166	68	47	9	10	20	8	8	3	3	163	40	16	9	9
156	80	33	14	5	19	10	11	11	3	148	69	33	9	6
95	61	29	7	2	10	8	15	9	2	76	72	1	5	1
154	42	51	12	2	14	10	5	11	4	133	17	28	11	3
145	73	45	11	9	11	8	7	2	1	159	42	50	8	8
147	84	46	12	5	20	6	7	10	1	129	92	61	15	5
157	49	57	8	7	19	12	5	7	4	168	19	30	11	6
183	67	40	5	4	19	8	4	12	4	161	61	22	1	4
158	54	65	18	4	17	17	5	9	3	156	67	45	13	4
164	83	43	7	11	18	14	5	12	3	133	62	52	5	10
161	93	49	7	3	13	12	14	11	4	130	100	39	11	2
99	73	30	10	9	12	16	12	9	2	80	51	37	9	8
161	75	34	13	2	11	6	7	10	1	163	47	35	18	1
99	82	50	8	4	17	11	12	8	2	92	61	54	7	3
96	40	54	9	1	19	7	10	9	3	69	12	47	11	0
177	81	48	14	1	18	11	9	6	4	181	86	40	14	1
130	48	31	9	4	20	6	14	10	3	129	52	15	11	4
96	76	28	8	3	14	13	15	10	1	81	85	5	3	4
106	73	64	20	7	20	6	5	4	3	83	86	74	18	8
160	85	55	5	4	16	12	7	11	3	141	76	51	5	4
157	58	57	10	6	21	17	10	2	2	156	49	39	10	5
97	45	48	20	3	15	7	8	9	4	112	38	23	23	4
127	84	39	19	5	12	11	13	12	4	123	61	27	17	6
173	48	54	18	11	20	13	6	4	4	157	21	29	20	10
167	52	53	9	8	20	7	11	6	1	159	22	28	13	9
135	52	52	5	5	18	8	11	11	4	105	37	48	11	6
100	69	41	20	6	14	16	13	12	3	90	50	31	14	5
97	71	40	15	6	17	10	5	3	2	93	72	20	14	7
115	64	62	16	10	19	7	4	6	3	116	65	59	20	10
152	89	41	17	1	12	10	11	4	2	163	72	13	12	1
129	38	63	11	5	10	10	11	12	3	120	30	33	14	6
123	81	41	12	2	17	7	7	9	4	103	96	51	6	1
182	53	54	15	1	16	6	5	4	2	167	48	29	11	2
135	58	52	6	10	18	17	9	4	4	135	32	62	7	11
107	88	28	6	3	13	12	8	11	2	119	57	17	10	2
138	93	31	13	7	16	16	5	6	3	117	79	41	10	8
180	40	26	10	5	10	12	6	7	2	175	14	12	9	6
165	44	30	19	4	18	17	10	9	4	144	45	36	15	5
149	63	63	12	2	10	13	5	4	3	162	44	57	8	1
166	93	65	10	3	15	9	6	6	4	145	79	62	14	2
178	49	54	12	5	18	15	7	6	1	175	53	48	12	6
157	93	28	7	9	11	8	11	8	4	150	76	12	6	10
148	91	41	11	7	14	16	6	11	2	158	68	57	10	8
108	74	59	5	4	21	13	14	8	1	104	63	66	2	4
120	80	55	7	5	12	11	6	6	3	115	55	26	7	6
157	46	53	6	6	16	8	6	11	3	128	37	35	8	5
100	60	33	14	4	13	10	15	3	4	70	74	6	20	5
112	56	56	11	9	21	14	15	3	4	120	49	67	17	10
99	88	52	13	11	17	16	6	11	3	71	104	45	10	10
146	63	47	11	5	10	6	9	5	1	159	36	52	5	5
114	86	47	13	5	11	16	11	2	2	130	71	54	9	6
109	89	45	14	2	14	16	8	9	4	97	97	17	12	2
179	76	60	20	9	13	17	11	4	3	164	80	55	25	10
107	93	43	9	11	14	6	7	10	2	79	97	28	6	11
154	44	62	8	3	19	13	5	6	2	143	47	36	2	3
153	82	35	6	1	18	11	8	7	1	123	66	13	2	2
94	55	65	12	8	15	12	4	8	3	102	27	39	12	9
120	46	61	11	10	16	15	15	10	4	134	54	62	12	11
139	80	28	15	9	11	6	9	3	3	147	87	17	14	10
181	66	46	6	6	12	8	12	11	1	163	77	39	12	6
152	39	41	7	3	11	14	15	9	2	140	34	16	2	4
174	87	35	9	2	14	7	9	10	2	149	100	19	6	1
165	44	57	14	5	18	8	7	6	3	175	37	54	15	6
117	84	38	11	1	15	14	7	5	3	132	63	52	17	0
128	46	58	10	8	12	6	8	5	1	141	55	37	16	7
131	75	48	13	1	15	12	15	4	1	138	76	31	17	1
111	62	42	8	6	13	11	8	12	1	124	64	11	6	7
134	79	62	18	2	18	6	12	5	4	148	67	57	23	2
110	65	48	9	11	19	7	11	4	4	120	52	36	4	11
157	90	62	16	11	21	10	6	10	4	144	94	67	19	10
122	90	29	12	10	13	11	7	7	4	131	60	-2	14	11
108	82	26	16	11	15	14	11	11	3	108	79	42	15	11
126	45	39	14	10	14	12	14	2	1	131	32	52	11	10
151	41	27	5	10	21	16	11	11	2	159	52	11	10	9
93	73	50	9	9	18	6	9	2	4	88	70	30	12	10
155	66	31	11	6	12	8	5	10	4	151	40	44	6	5
145	45	59	17	8	16	6	14	5	2	136	53	58	18	7
102	55	62	7	4	15	6	6	11	2	95	38	54	10	3
108	71	47	5	5	16	7	8	5	1	95	66	45	1	6
103	70	39	18	9	17	14	9	4	4	103	47	31	14	8
116	49	27	10	5	20	13	10	7	3	102	37	18	4	4
132	87	51	10	2	13	6	13	5	1	138	81	47	15	2
104	61	62	8	1	10	10	10	3	1	107	48	60	4	0
118	91	26	11	11	11	15	11	5	4	121	85	-1	15	10
139	69	42	12	2	13	12	10	10	2	112	40	35	7	1
182	79	56	7	5	12	6	7	7	2	183	54	51	9	4
173	90	54	7	3	11	14	4	7	3	161	94	31	4	4
113	49	60	15	8	10	14	5	7	3	106	61	35	10	9
143	67	59	7	6	14	16	10	11	1	139	65	38	10	7
"""
}

# Thresholds for difference checks (ms)
thresholds = {
    "Keystroke Latency": 25,
    "Navigation Latency": 50,
    "Load Time": 5000
}


# === FUNCTIONS ===
def create_boxplot_with_beeswarm(data, title):
    fig, ax = plt.subplots(figsize=(12, 8))
    columns = data.columns
    box_data = [data[col].values for col in columns]

    ax.boxplot(box_data, labels=columns, patch_artist=True,
               boxprops=dict(facecolor='lightblue', alpha=0.7),
               medianprops=dict(color='red', linewidth=2))

    for i, col in enumerate(columns):
        y = data[col].values
        x = np.random.normal(i+1, 0.04, size=len(y))
        ax.scatter(x, y, alpha=0.6, s=20, color='darkblue', zorder=3)

    ax.set_title(title, fontsize=16, fontweight='bold')
    ax.set_xlabel('Memory Configuration', fontsize=12)
    ax.set_ylabel('Performance Value (ms)', fontsize=12)
    ax.grid(True, alpha=0.3)

    stats_text = [f'{col}: μ={data[col].mean():.1f}, Med={data[col].median():.1f}, σ={data[col].std():.1f}' 
                  for col in columns]
    ax.text(0.02, 0.98, "\n".join(stats_text), transform=ax.transAxes, fontsize=9,
            verticalalignment='top', bbox=dict(boxstyle='round', facecolor='white', alpha=0.8))
    plt.tight_layout()
    return fig, ax

def split_screenreader_data(datasets):
    split_datasets = {}
    for metric_name, table_str in datasets.items():
        df = pd.read_csv(StringIO(table_str), sep=r"\s+", engine="python")
        jaws_cols = [c for c in df.columns if c.upper().startswith("JAWS")]
        nvda_cols = [c for c in df.columns if c.upper().startswith("NVDA")]
        supernova_cols = [c for c in df.columns if c.upper().startswith("SUPER")]

        metric_key = re.sub(r"\s+", "_", metric_name.strip().lower())
        metric_key = metric_key.replace("response", "latency")

        if jaws_cols:
            split_datasets[f"{metric_key}_JAWS"] = df[jaws_cols]
        if nvda_cols:
            split_datasets[f"{metric_key}_NVDA"] = df[nvda_cols]
        if supernova_cols:
            split_datasets[f"{metric_key}_Supernova"] = df[supernova_cols]
    return split_datasets

def melt_and_order(metric_label, dataset_str):
    df = pd.read_csv(StringIO(dataset_str), sep=r"\s+", engine="python")
    df_long = df.melt(var_name="Config", value_name="Latency")
    df_long["RAM"] = df_long["Config"].str.extract(r'(\d+GB)')
    df_long["ScreenReader"] = df_long["Config"].str.replace(r'\d+GB', '', regex=True).str.upper()
    sr_order = ["JAWS", "SUPERNOVA", "NVDA"]
    df_long["ScreenReader"] = pd.Categorical(df_long["ScreenReader"], categories=sr_order, ordered=True)
    df_long["Metric"] = metric_label
    return df_long

def descriptive_stats(df_long):
    return df_long.groupby("ScreenReader")["Latency"].agg(["mean", "median", "std", "min", "max"]).round(2)

def pairwise_tests(df_long, threshold):
    results = []
    srs = df_long["ScreenReader"].cat.categories
    for sr1, sr2 in combinations(srs, 2):
        data1 = df_long[df_long["ScreenReader"] == sr1]["Latency"]
        data2 = df_long[df_long["ScreenReader"] == sr2]["Latency"]
        t_stat, p_val = ttest_ind(data1, data2, equal_var=False)
        mean_diff = data1.mean() - data2.mean()
        passes_thresh = abs(mean_diff) > threshold
        significant = p_val < 0.05
        results.append({
            "Comparison": f"{sr1} vs {sr2}",
            "Mean Diff (ms)": round(mean_diff, 2),
            "t-stat": round(t_stat, 3),
            "p-value": round(p_val, 4),
            f"Diff > {threshold}ms": "Yes" if passes_thresh else "No",
            "Statistically Significant": "Yes" if significant else "No"
        })
    return pd.DataFrame(results)

# === MAIN ===
print("Splitting datasets...")
split_datasets = split_screenreader_data(datasets)

print("Saving individual plots and CSVs...")
for name, subdf in split_datasets.items():
    csv_path = os.path.join(SAVE_DIR, f"{name}.csv")
    subdf.to_csv(csv_path, index=False)
    print(f"Saved CSV: {csv_path}")

    fig, ax = create_boxplot_with_beeswarm(subdf, f"{name} Performance by RAM")
    png_path = os.path.join(SAVE_DIR, f"{name}.png")
    fig.savefig(png_path, dpi=300)
    plt.close(fig)
    print(f"Saved PNG: {png_path}")

# === COMPOSITE PLOTS ===
print("Creating composite multi-metric plot...")
keystroke_long = melt_and_order("Keystroke Latency", datasets["Keystroke Response"])
navigation_long = melt_and_order("Navigation Latency", datasets["Navigation Commands"])
load_long = melt_and_order("Load Time", datasets["Load Time"])

# 3-metric stacked figure
fig, axes = plt.subplots(3, 1, figsize=(14, 18), sharex=True)
sns.boxplot(ax=axes[0], data=keystroke_long, x="RAM", y="Latency", hue="ScreenReader")
axes[0].set_title("Keystroke Latency by RAM and Screen Reader", fontsize=14)

sns.boxplot(ax=axes[1], data=navigation_long, x="RAM", y="Latency", hue="ScreenReader")
axes[1].set_title("Navigation Command Latency by RAM and Screen Reader", fontsize=14)

sns.boxplot(ax=axes[2], data=load_long, x="RAM", y="Latency", hue="ScreenReader")
axes[2].set_title("Load Time by RAM and Screen Reader", fontsize=14)

for ax in axes:
    ax.grid(True, alpha=0.3)
    ax.set_ylabel("Latency (ms)")
axes[2].set_xlabel("RAM Configuration")

plt.tight_layout()
comp_path = os.path.join(SAVE_DIR, "composite_latency.png")
fig.savefig(comp_path, dpi=300)
plt.close(fig)
print(f"Saved composite figure: {comp_path}")

# Per-metric composite plots
def make_single_metric_plot(df_long, title, filename):
    fig, ax = plt.subplots(figsize=(14, 6))
    sns.boxplot(ax=ax, data=df_long, x="RAM", y="Latency", hue="ScreenReader")
    ax.set_title(title, fontsize=14)
    ax.set_ylabel("Latency (ms)")
    ax.set_xlabel("RAM Configuration")
    ax.grid(True, alpha=0.3)
    ax.legend(title="Screen Reader", loc="upper right")
    plt.tight_layout()
    out_path = os.path.join(SAVE_DIR, filename)
    fig.savefig(out_path, dpi=300)
    plt.close(fig)
    print(f"Saved composite: {out_path}")

make_single_metric_plot(keystroke_long, "Keystroke Latency by RAM and Screen Reader", "composite_keystroke_latency.png")
make_single_metric_plot(navigation_long, "Navigation Command Latency by RAM and Screen Reader", "composite_navigation_latency.png")
make_single_metric_plot(load_long, "Load Time by RAM and Screen Reader", "composite_load_time.png")

# === STATISTICAL ANALYSIS ===
print("Calculating statistics...")
all_stats_md = []

# In the statistical analysis loop:
for metric_label, raw_data in datasets.items():
    metric_label_clean = (metric_label
                          .replace("Response", "Latency")
                          .replace("Commands", "Latency"))
    df_long = melt_and_order(metric_label_clean, raw_data)

    desc = descriptive_stats(df_long)
    all_stats_md.append(f"## {metric_label_clean} — Descriptive Statistics\n")
    all_stats_md.append(desc.to_markdown())
    all_stats_md.append("\n")

    thresh = thresholds[metric_label_clean]
    tests_df = pairwise_tests(df_long, thresh)
    all_stats_md.append(f"## {metric_label_clean} — Pairwise Comparisons (Threshold {thresh} ms)\n")
    all_stats_md.append(tests_df.to_markdown(index=False))
    all_stats_md.append("\n")


with open(STATS_FILE, "w") as f:
    f.write("\n".join(all_stats_md))

print(f"Stats saved to {STATS_FILE}")
print("\nALL FILES SAVED SUCCESSFULLY to", SAVE_DIR)
\end{pyverbatim}

\section{Statistical Analysis}
\subsection*{Keystroke Latency Descriptive Statistics}
\footnotesize
\begin{longtblr}[
    caption = {Keystroke latency central tendency and dispersion: JAWS shows highest mean and variability, NVDA lowest latency and variance, SuperNova intermediate but closer to JAWS in spread.},
    label = {tab:keystroke-desc},
    note = {This table summarizes distribution characteristics (mean, median, standard deviation, minima, maxima) of measured keystroke-to-speech latencies (milliseconds) across all RAM configurations for each screen reader. Higher mean and large standard deviation for JAWS indicate greater and more inconsistent delay; NVDA's lower mean and tighter spread suggest more predictable responsiveness; SuperNova exhibits moderate central latency but wide spread implying occasional very high delays. These descriptive metrics contextualize subsequent inferential tests by revealing baseline performance profiles.}
]{
    colspec = {X[l] X[c] X[c] X[c] X[c] X[c]},
    rowhead = 1,
    row{1} = {font=\normalfont},
    hlines,
    stretch = 1.3
}
ScreenReader & Mean & Median & Std Dev & Min & Max \\
JAWS & 233.657 & 144 & 241.221 & 15 & 992 \\
NVDA & 124.354 & 116 & 88.0154 & 10 & 399 \\
SUPERNOVA & 201.152 & 108 & 224.755 & 4 & 945 \\
\end{longtblr}
\normalsize

\subsection*{Keystroke Latency Two-Way ANOVA}
\footnotesize
\begin{longtblr}[
    caption = {ANOVA for keystroke latency shows strong main effects of Screen Reader and RAM plus a significant interaction, indicating hardware scaling effects differ by reader.},
    label = {tab:keystroke-anova},
    note = {A two-way fixed-effects ANOVA assessed impacts of Screen Reader (JAWS, NVDA, SuperNova) and RAM (8--64GB) on keystroke latency. Large F statistics with p<0.001 across factors and interaction demonstrate (1) systematic latency differences among products, (2) substantial performance gains with increased RAM, and (3) non-parallel improvement curves (interaction) suggesting some readers capitalize on memory upgrades more effectively. Residual term reflects remaining variability (nan entries for per-cell mean square shown by original export).}
]{
    colspec = {X[l] X[c] X[c] X[c] X[c]},
    rowhead = 1,
    row{1} = {font=\normalfont},
    hlines,
    stretch = 1.25
}
Source & Sum Sq & df & F & Pr(>F) \\
C(ScreenReader) & 3118773.973 & 2 & 140.152 & 0.000 \\
C(RAM) & 35914546.707 & 4 & 806.969 & 0.000 \\
C(ScreenReader):C(RAM) & 5255586.525 & 8 & 59.044 & 0.000 \\
Residual & 16355763.152 & 1470 & n/a & n/a \\
\end{longtblr}
\normalsize

\subsection*{Keystroke Latency Pairwise T-Tests}
\footnotesize
\begin{longtblr}[
    caption = {Pairwise comparisons for keystroke latency: JAWS significantly slower than NVDA and SuperNova; SuperNova significantly slower than NVDA; all mean gaps exceed 25 ms threshold.},
    label = {tab:keystroke-pairwise},
    note = {Welch two-sample t-tests compare mean keystroke latencies between screen reader pairs. The practical significance criterion was a mean gap exceeding 25 ms. All observed differences are both statistically significant (p<0.05) and practically meaningful, reinforcing NVDA's latency advantage and indicating SuperNova, while closer to JAWS than NVDA, still lags NVDA by a wide margin.}
]{
    colspec = {X[l] X[c] X[c] X[c] X[c]},
    rowhead = 1,
    row{1} = {font=\normalfont},
    hlines,
    stretch = 1.25
}
Comparison & Mean Diff (ms) & t-stat & p-value & Diff > 25ms / Significant \\
JAWS vs NVDA & 109.30 & 9.47 & 0.0000 & Yes / Yes \\
JAWS vs SUPERNOVA & 32.51 & 2.19 & 0.0290 & Yes / Yes \\
NVDA vs SUPERNOVA & -76.80 & -7.08 & 0.0000 & Yes / Yes \\
\end{longtblr}
\normalsize

\subsection*{Navigation Latency Descriptive Statistics}
\footnotesize
\begin{longtblr}[
    caption = {Navigation command latency mirrors keystroke pattern: NVDA fastest and most stable, JAWS highest average and spread, SuperNova intermediate with wide variability.},
    label = {tab:navigation-desc},
    note = {Descriptive metrics for navigation (multi-key / structural movement) latency highlight consistent relative ordering across readers. JAWS exhibits the greatest mean delay (232 ms) and variability (SD 245 ms). NVDA again demonstrates tight clustering around a low central value (mean 126 ms). SuperNova's broad range (0--946 ms) indicates occasional severe outliers that could impair user experience unpredictably.}
]{
    colspec = {X[l] X[c] X[c] X[c] X[c] X[c]},
    rowhead = 1,
    row{1} = {font=\normalfont},
    hlines,
    stretch = 1.3
}
ScreenReader & Mean & Median & Std Dev & Min & Max \\
JAWS & 232.095 & 153 & 245.074 & 10 & 996 \\
NVDA & 126.974 & 124 & 90.9072 & 10 & 399 \\
SUPERNOVA & 198.561 & 112 & 230.571 & 0 & 946 \\
\end{longtblr}
\normalsize

\subsection*{Navigation Latency Two-Way ANOVA}
\footnotesize
\begin{longtblr}[
    caption = {Two-way ANOVA for navigation latency shows significant main and interaction effects; RAM scaling benefits differ per screen reader similar to keystrokes.},
    label = {tab:navigation-anova},
    note = {The model indicates Screen Reader choice and RAM capacity both strongly affect navigation latency, with a significant interaction suggesting some engines optimize internal caching or event handling more aggressively as memory increases. This interaction guides hardware recommendations tailored to specific software.}
]{
    colspec = {X[l] X[c] X[c] X[c] X[c]},
    rowhead = 1,
    row{1} = {font=\normalfont},
    hlines,
    stretch = 1.25
}
Source & Sum Sq & df & F & Pr(>F) \\
C(ScreenReader) & 2854450.697 & 2 & 135.553 & 0.000 \\
C(RAM) & 38949932.259 & 4 & 924.834 & 0.000 \\
C(ScreenReader):C(RAM) & 5587845.422 & 8 & 66.339 & 0.000 \\
Residual & 15477485.197 & 1470 & n/a & n/a \\
\end{longtblr}
\normalsize

\subsection*{Navigation Latency Pairwise T-Tests}
\footnotesize
\begin{longtblr}[
    caption = {Pairwise navigation latency tests: JAWS slower than NVDA and SuperNova; SuperNova slower than NVDA; only JAWS vs SuperNova mean gap below 50 ms threshold though still statistically significant.},
    label = {tab:navigation-pairwise},
    note = {Welch t-tests with a practical difference criterion of 50 ms show statistically significant differences for all pairs. However, JAWS vs SuperNova (33.53 ms) fails the predefined practical threshold, implying user-perceived difference may be smaller than statistical detection. NVDA maintains a substantial performance lead relative to both competitors.}
]{
    colspec = {X[l] X[c] X[c] X[c] X[c]},
    rowhead = 1,
    row{1} = {font=\normalfont},
    hlines,
    stretch = 1.25
}
Comparison & Mean Diff (ms) & t-stat & p-value & Diff > 50ms / Significant \\
JAWS vs NVDA & 105.12 & 8.95 & 0.0000 & Yes / Yes \\
JAWS vs SUPERNOVA & 33.53 & 2.22 & 0.0270 & No / Yes \\
NVDA vs SUPERNOVA & -71.59 & -6.43 & 0.0000 & Yes / Yes \\
\end{longtblr}
\normalsize

\subsection*{Load Time Descriptive Statistics}
\footnotesize
\begin{longtblr}[
    caption = {Initial screen reader load times: NVDA launches an order of magnitude faster; JAWS and SuperNova exhibit similarly high means and large variability with extreme maxima.},
    label = {tab:load-desc},
    note = {Load times (ms) represent cold-start initialization durations from invocation to first audible readiness. NVDA's mean (≈9.1 s) and moderate SD underscore efficiency. JAWS and SuperNova have much higher means (≈53 s and 48 s respectively) and large standard deviations exceeding their means, indicating unstable startup performance and potential user wait frustration. Negative minimum for SuperNova reflects a logging or measurement anomaly retained for transparency.}
]{
    colspec = {X[l] X[c] X[c] X[c] X[c] X[c]},
    rowhead = 1,
    row{1} = {font=\normalfont},
    hlines,
    stretch = 1.3
}
ScreenReader & Mean & Median & Std Dev & Min & Max \\
JAWS & 53284.8 & 44000 & 49296.7 & 1000 & 183000 \\
NVDA & 9058.59 & 9000 & 5146.3 & 1000 & 21000 \\
SUPERNOVA & 48236.4 & 32000 & 48057.7 & -2000 & 183000 \\
\end{longtblr}
\normalsize

\subsection*{Load Time Two-Way ANOVA}
\footnotesize
\begin{longtblr}[
    caption = {ANOVA for load time: substantial effects of Screen Reader, RAM, and their interaction; memory upgrades disproportionately reduce heavy readers' startup cost.},
    label = {tab:load-anova},
    note = {Two-way ANOVA indicates both software architecture and available RAM significantly drive cold-start durations (all p<0.001). Interaction term implies diminishing returns for faster reader (NVDA) while higher-latency readers (JAWS, SuperNova) gain more from added RAM, informing procurement strategies emphasizing memory when those products are mandated.}
]{
    colspec = {X[l] X[c] X[c] X[c] X[c]},
    rowhead = 1,
    row{1} = {font=\normalfont},
    hlines,
    stretch = 1.25
}
Source & Sum Sq & df & F & Pr(>F) \\
C(ScreenReader) & 580197383164.989 & 2 & 1517.511 & 0.000 \\
C(RAM) & 1494231276767.673 & 4 & 1954.086 & 0.000 \\
C(ScreenReader):C(RAM) & 579251983838.387 & 8 & 378.759 & 0.000 \\
Residual & 281016222222.222 & 1470 & n/a & n/a \\
\end{longtblr}
\normalsize

\subsection*{Load Time Pairwise T-Tests}
\footnotesize
\begin{longtblr}[
    caption = {Pairwise load time gaps: NVDA dramatically faster than both others (>>5000 ms threshold); JAWS vs SuperNova difference not statistically significant despite exceeding practical threshold.},
    label = {tab:load-pairwise},
    note = {Welch t-tests applied with a 5000 ms practical importance threshold. NVDA's substantial mean advantage over JAWS and SuperNova is both statistically and practically significant, recommending it for environments where rapid startup is critical. JAWS vs SuperNova shows a mean gap (~5.0 s) meeting the practical threshold but lacking statistical support (p=0.103), suggesting overlapping high variability; users may not consistently experience a difference.}
]{
    colspec = {X[l] X[c] X[c] X[c] X[c]},
    rowhead = 1,
    row{1} = {font=\normalfont},
    hlines,
    stretch = 1.25
}
Comparison & Mean Diff (ms) & t-stat & p-value & Diff > 5000ms / Significant \\
JAWS vs NVDA & 44226.30 & 19.85 & 0.0000 & Yes / Yes \\
JAWS vs SUPERNOVA & 5048.48 & 1.63 & 0.1030 & Yes / No \\
NVDA vs SUPERNOVA & -39177.80 & -18.03 & 0.0000 & Yes / Yes \\
\end{longtblr}
\normalsize
